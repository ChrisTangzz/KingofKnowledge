<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesfolder\main.css">
    <title>KingofKnowledge</title>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jqueryrouter@2.2.11/dist/js/jquery.router.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"
        referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <script type="text/javascript">
        firebase.initializeApp({
            projectId: "finalhtml"
        });
        var db = firebase.firestore();
        var ref2 = db.collection("PersonGrade").doc("total");
        let point;
        let cookie = Object.keys($.cookie());
        const audiostart = new Audio("audio/start.mp3");
        const audiostop = new Audio("audio/stop.mp3");
        const audio = [];
        const subjects = ["computer", "programming", "physics", "discreteMath", "digitalLogic", "liner", "calculus"];
        $(document).ready(function () {
            ref2.get().then(doc => {
                point = doc.data().grade;
                $("#grade").html("<strong>" + "目前分數為:" + point + "</strong>");
            });
            if (Object.keys($.cookie()).length == 8) {
                $("#inputnameModal").modal("show");
            }
            else if($.cookie("restart")){
                $.cookie("restart",0);
                restart();
            }
            $("#restart").click(function () {
                restart();
            });
            for (let sub in subjects) {
                $("#" + subjects[sub]).click(function () {
                    if ($.cookie(subjects[sub])) {
                        window.alert("你已經作答過了喔，請選擇其他題");
                        audiostop.play();
                    }
                    else {
                        audiostart.play();
                        HidePic();
                        setTimeout(SetPicsrc(this), 1000);
                    }
                });
            }
            for (let i = 1; i <= 3; i++) {
                $("#chose" + i).click(function () {
                    let nowid = this.id;
                    let string = $("#pic" + i).attr("src");
                    string = string.slice(13, -5);
                    $.cookie(string, i);
                    $.cookie("object", string + i);
                });
            }
            for (let i = 1; i <= 3; i++) {
                $("#chose" + i).mouseover(function () {
                    audio[i] = new Audio("audio/" + i + ".mp3");
                    audio[i].play();
                });
            }
        });
        function SetPicsrc(object) {
            let picname = object.id;
            for (let i = 1; i <= 3; i++) {
                $("#pic" + i).attr("src", "imagesfolder/" + picname + i + ".png");
            }
            for (let i = 1; i <= 3; i++) {
                $("#chose" + i).fadeIn(i * 1000);
            }
        }
        function HidePic() {
            for (let i = 1; i <= 3; i++) {
                $("#chose" + i).hide();
            }
        }
        function Store() {
            console.log($("#recipient-name").val());
            var ref = db.collection("rank").doc($("#recipient-name").val());
            ref.set({
                grade: point
            }).then(() => {
                console.log("YES");
                window.location.href = "rank.html";
            });
        }
        function restart(){
            for (let i = 0; i < cookie.length; i++) {
                $.removeCookie(cookie[i]);
            }
            ref2.update({
                grade: 0
            }).then(() => {
                location.reload();
            });
        }
    </script>
</head>

<body>
    <p id="grade" style="color:gold; position: absolute; left: 1500px; text-shadow:5px 5px 5px red;"></p>
    <div class="modal fade" id="inputnameModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Please Input Your Name</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="recipient-name" class="col-form-label">Name:</label>
                            <input type="text" class="form-control" id="recipient-name">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="Store()">Send message</button>
                </div>
            </div>
        </div>
    </div>
    <div class="row" style="position: absolute; top: 800px;">
        <div class="col-lg-6" style="margin-top: 10px !important; padding:0px !important;">
            <button type="button" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#exampleModal"
                style="width: 485px;  box-sizing: border-box;">遊戲規則</button>
        </div>
        <div class="col-lg-6" style="margin-top: 10px !important; padding:0px !important;">
            <button id="restart" type="button" class="btn btn-outline-info"
                style="width: 485px;  box-sizing: border-box;">重啟遊戲</button>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="exampleModalLabel">遊戲規則:</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body"><span></span>
                    <span class="rule">1.玩家需要完成七大科目即可結束遊戲。</span><br>
                    <span class="rule">2.每個科目有三種不同的難度，每科目限選一次。</span><br>
                    <span class="rule">3.結束遊戲時，會請玩家輸入名稱，並將分數放上排行榜。</span><br>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div id="list" class="div">
        <div class="middle">
            <p>主題目錄</p>
        </div>
        <div class="middle">
            <ul id="object">
                <li id="computer"><img src="imagesfolder/computer.png" width="50" height="50">計算機概論</li>
                <li id="programming"><img src="imagesfolder/programming.png" width="50" height="50">程式設計</li>
                <li id="physics"><img src="imagesfolder/physics.png" width="50" height="50">普通物理</li>
                <li id="discreteMath"><img src="imagesfolder/discreteMath.png" width="50" height="50">離散數學</li>
                <li id="digitalLogic"><img src="imagesfolder/digitalLogic.png" width="50" height="50">數位邏輯</li>
                <li id="liner"><img src="imagesfolder/liner.png" width="50" height="50">線性代數</li>
                <li id="calculus"><img src="imagesfolder/calculus.png" width="50" height="50">微積分</li>
            </ul>
        </div>
    </div>
    <div id="chose" class="div">
        <div class="middle">
            <ul class="grades">
                <a id="src1" href="ques.html">
                    <li id="chose1" class="colorgrades"><img id="pic1" src="imagesfolder/computer1.png" width="50"
                            height="50">100</li>
                </a>
                <a id="src2" href="ques.html">
                    <li id="chose2" class="colorgrades"><img id="pic2" src="imagesfolder/computer2.png" width="50"
                            height="50">200</li>
                </a>
                <a id="src3" href="ques.html">
                    <li id="chose3" class="colorgrades"><img id="pic3" src="imagesfolder/computer3.png" width="50"
                            height="50">300</li>
                </a>
            </ul>
        </div>
    </div>
</body>

</html>